<div class="nba-dashboard">
  <div class="nba-dashboard__container">
    <!-- Hero Section -->
    <section class="hero">
      <div class="hero__content">
        <h1 class="hero__title">
          <span class="hero__title-main">Hoop</span>
          <span class="hero__title-accent">Game Night</span>
        </h1>
        <p class="hero__subtitle">
          Acompanhe jogos, estat√≠sticas e predi√ß√µes da NBA em tempo real
        </p>
      </div>
      
      <!-- API Status Integration -->
      <div class="hero__status">
        <div class="api-status-mini">
          <span class="api-status-mini__label">API Status</span>
          <app-status-indicator 
            [status]="healthCheck.status()"
            [showText]="true"
            size="small">
          </app-status-indicator>
        </div>
      </div>
    </section>

    <!-- Today's Games Section -->
    <section class="games-section">
      <div class="section-header">
        <h2 class="section-title">
          @if (selectedDateOption === 'today') {
            Jogos de Hoje
          } @else if (selectedDateOption === 'yesterday') {
            Jogos de Ontem
          } @else {
            Jogos de Amanh√£
          }
        </h2>
        <div class="section-actions">
          @if (hasLiveGames()) {
            <span class="live-games-badge">
              <span class="live-indicator"></span>
              {{ getLiveGamesCount() }} ao vivo
            </span>
          }
          <select class="date-selector" (change)="onDateChange($event)" [value]="selectedDateOption">
            <option value="today">Hoje</option>
            <option value="yesterday">Ontem</option>
            <option value="tomorrow">Amanh√£</option>
          </select>
        </div>
      </div>

      <div class="games-preview">
        @if (gamesService.isLoading()) {
          <div class="games-loading">
            <div class="loading-spinner"></div>
            <p>
              @if (selectedDateOption === 'today') {
                Carregando jogos de hoje...
              } @else if (selectedDateOption === 'yesterday') {
                Carregando jogos de ontem...
              } @else {
                Carregando jogos de amanh√£...
              }
            </p>
          </div>
        } @else if (gamesService.error()) {
          <div class="games-error">
            <span class="material-icons">error</span>
            <h3>Erro ao carregar jogos</h3>
            <p>{{ gamesService.error() }}</p>
            <button class="btn btn--primary" routerLink="/games">
              <span class="material-icons">refresh</span>
              Tentar Novamente
            </button>
          </div>
        } @else if (getTodayGamesCount() === 0) {
          <div class="games-placeholder">
            <div class="games-placeholder__icon">üèÄ</div>
            <h3>
              @if (selectedDateOption === 'today') {
                Nenhum jogo hoje
              } @else if (selectedDateOption === 'yesterday') {
                Nenhum jogo ontem
              } @else {
                Nenhum jogo amanh√£
              }
            </h3>
            <p>N√£o h√° jogos da NBA agendados para esta data</p>
            <button class="btn btn--primary" routerLink="/games">
              <span class="material-icons">calendar_today</span>
              Ver Outros Dias
            </button>
          </div>
        } @else {
          <div class="games-mini-list">
            @for (game of getCurrentGames(); track trackByGameId($index, game)) {
              <div class="game-mini-card"
                   [class.game-mini-card--live]="game.isLive"
                   [class.game-mini-card--completed]="game.isCompleted">

                <!-- Time Visitante-->
                <div class="game-mini-card__team team--clickable" (click)="navigateToTeam(game.visitorTeam.abbreviation)">
                  <img
                    [src]="getTeamLogoUrl(game.visitorTeam.abbreviation)"
                    [alt]="game.visitorTeam.name"
                    class="team-logo"
                    (error)="handleLogoError($event, game.visitorTeam.abbreviation)"
                    loading="lazy">
                  <div class="team-info">
                    <span class="team-abbr">{{ game.visitorTeam.abbreviation }}</span>
                    <span class="team-name">{{ game.visitorTeam.displayName }}</span>
                  </div>
                  @if (game.isCompleted || game.isLive) {
                    <span class="team-score" [class.winner]="game.winningTeam?.id === game.visitorTeam.id">
                      {{ game.visitorTeamScore ?? 0 }}
                    </span>
                  }
                </div>

                <!-- Separador VS -->
                <div class="game-mini-card__vs">vs</div>

                <!-- Time da Casa -->
                <div class="game-mini-card__team team--clickable" (click)="navigateToTeam(game.homeTeam.abbreviation)">
                  <img
                    [src]="getTeamLogoUrl(game.homeTeam.abbreviation)"
                    [alt]="game.homeTeam.name"
                    class="team-logo"
                    (error)="handleLogoError($event, game.homeTeam.abbreviation)"
                    loading="lazy">
                  <div class="team-info">
                    <span class="team-abbr">{{ game.homeTeam.abbreviation }}</span>
                    <span class="team-name">{{ game.homeTeam.displayName }}</span>
                  </div>
                  @if (game.isCompleted || game.isLive) {
                    <span class="team-score" [class.winner]="game.winningTeam?.id === game.homeTeam.id">
                      {{ game.homeTeamScore ?? 0 }}
                    </span>
                  }
                </div>

                <!-- Info do Jogo -->
                <div class="game-mini-card__info">
                  @if (game.isLive) {
                    <span class="status status--live">
                      <span class="live-dot"></span>
                      LIVE
                    </span>
                  } @else if (game.isCompleted) {
                    <span class="status status--completed">Final</span>
                  } @else {
                    <span class="time">{{ formatGameTime(game.dateTime) }}</span>
                  }
                </div>
              </div>
            }
          </div>
          
          <div class="games-summary">
            <div class="summary-stats">
              <div class="stat">
                <span class="stat__value">{{ getTodayGamesCount() }}</span>
                <span class="stat__label">Total</span>
              </div>
              @if (hasLiveGames()) {
                <div class="stat stat--live">
                  <span class="stat__value">{{ getLiveGamesCount() }}</span>
                  <span class="stat__label">Ao Vivo</span>
                </div>
              }
              <div class="stat">
                <span class="stat__value">{{ gamesService.completedGames().length }}</span>
                <span class="stat__label">Finalizados</span>
              </div>
            </div>
            
            <button class="btn btn--primary" routerLink="/games">
              <span class="material-icons">sports_basketball</span>
              Ver Todos os Jogos
            </button>
          </div>
        }
      </div>
    </section>

    <!-- Bottom Grid -->
    <div class="dashboard-grid">
      <!-- My Teams -->
      <section class="my-teams">
        <h3 class="section-title-small">Meus Times</h3>
        
        <div class="teams-list">
          @for (team of myTeams; track team.code) {
            <div class="team-card" [style.border-left-color]="team.color">
              <div class="team-card__info">
                <span class="team-card__code">{{ team.code }}</span>
                <div class="team-card__details">
                  <span class="team-card__name">{{ team.name }}</span>
                  <span class="team-card__city">{{ team.city }}</span>
                </div>
              </div>
              <div class="team-card__next">
                <span class="team-card__next-label">Pr√≥ximo:</span>
                <span class="team-card__next-game">{{ team.nextGame }}</span>
              </div>
            </div>
          }
        </div>
      </section>

      <!-- Search Player -->
      <section class="player-search">
        <h3 class="section-title-small">Buscar Jogador</h3>

        <div class="search-box">
          <input
            type="text"
            class="search-input"
            placeholder="LeBron James, Stephen Curry..."
            [ngModel]="playerSearchQuery()"
            (ngModelChange)="updatePlayerSearch($event)"
            (keyup.enter)="searchPlayers()">
          <button class="search-btn" (click)="searchPlayers()" [disabled]="playerSearchQuery().length < 2">
            <span class="material-icons">search</span>
          </button>
        </div>

        @if (showPlayerResults()) {
          <div class="search-results-dropdown">
            @if (isSearchingPlayers()) {
              <div class="search-loading">
                <div class="loading-spinner-small"></div>
                <span>Buscando...</span>
              </div>
            } @else if (playerSearchResults().length === 0) {
              <div class="search-no-results">
                <span class="material-icons">person_search</span>
                <p>Nenhum jogador encontrado</p>
              </div>
            } @else {
              <div class="search-results-list">
                @for (player of playerSearchResults(); track player.id) {
                  <div class="search-result-item" (click)="selectPlayer(player)">
                    <img
                      [src]="getPlayerPhotoUrl(player)"
                      [alt]="player.fullName"
                      class="player-thumb"
                      (error)="onPlayerImageError($event)">
                    <div class="player-info">
                      <span class="player-name">{{ player.fullName }}</span>
                      <span class="player-details">{{ player.position }} - {{ player.team.displayName }}</span>
                    </div>
                  </div>
                }
              </div>
              <button class="btn btn--ghost btn--sm view-all-btn" routerLink="/players">
                Ver todos os jogadores
              </button>
            }
          </div>
        } @else {
          <p class="search-hint">
            Digite pelo menos 2 caracteres para buscar
          </p>
        }
      </section>

      <!-- AI Insights -->
      <section class="ai-insights">
        <h3 class="section-title-small">IA Insights</h3>
        
        <div class="insights-list">
          @for (insight of aiInsights; track insight.title) {
            <div class="insight-card" [class]="'insight-card--' + insight.type">
              <div class="insight-card__header">
                <span class="insight-card__title">{{ insight.title }}</span>
              </div>
              <p class="insight-card__description">{{ insight.description }}</p>
            </div>
          }
        </div>
      </section>

      <!-- System Status -->
      <section class="system-status">
        <h3 class="section-title-small">Status do Sistema</h3>
        
        <div class="status-list">
          <div class="status-item">
            <span class="status-item__label">NBA API</span>
            <app-status-indicator 
              [status]="healthCheck.status()"
              [showText]="true"
              size="small">
            </app-status-indicator>
          </div>
          
          <div class="status-item">
            <span class="status-item__label">Base de Dados</span>
            <app-status-indicator 
              [status]="ApiStatusEnum.ONLINE"
              [showText]="true"
              size="small">
            </app-status-indicator>
          </div>
          
          <div class="status-item">
            <span class="status-item__label">Cache</span>
            <app-status-indicator 
              [status]="ApiStatusEnum.ONLINE"
              [showText]="true"
              size="small">
            </app-status-indicator>
          </div>

          <button class="btn btn--ghost btn--sm" routerLink="/api-status">
            <span class="material-icons">monitor_heart</span>
            Detalhes
          </button>
        </div>
      </section>
    </div>
  </div>
</div>
