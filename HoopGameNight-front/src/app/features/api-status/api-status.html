<div class="api-status">
  <div class="api-status__container">
    <!-- Header -->
    <div class="api-status__header">
      <div>
        <h1 class="api-status__title">API Status Monitor</h1>
        <p class="api-status__subtitle">Confira em tempo real o status de cada api</p>
      </div>
      
      <button 
        class="btn btn--primary"
        (click)="onManualCheck()"
        [disabled]="healthCheck.status() === 'loading'">
        <span class="material-icons">refresh</span>
        Refresh Status
      </button>
    </div>

    <!-- Main Status Card -->
    <div class="api-status__main-card">
      <div class="status-overview">
        <div class="status-overview__icon">
          <app-status-indicator 
            [status]="healthCheck.status()"
            [showText]="false"
            size="large">
          </app-status-indicator>
        </div>
        
        <div class="status-overview__content">
          <h2 class="status-overview__title">{{ healthCheck.getStatusText() }}</h2>
          <p class="status-overview__description">
            @if (healthCheck.isOnline()) {
              All systems operational
            } @else if (healthCheck.isOffline()) {
              Service temporarily unavailable
            } @else {
              Checking system status...
            }
          </p>
        </div>

        <div class="status-overview__timestamp">
          <span class="timestamp-label">Last checked</span>
          <span class="timestamp-value">{{ healthCheck.getTimeSinceLastCheck() }}</span>
        </div>
      </div>
    </div>

    <!-- Detailed Information -->
    @if (healthCheck.healthData(); as data) {
      <div class="api-status__details">
        <div class="detail-card">
          <h3 class="detail-card__title">System Information</h3>

          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-item__label">Status</span>
              <span class="detail-item__value detail-item__value--success">{{ data.status }}</span>
            </div>

            <div class="detail-item">
              <span class="detail-item__label">Health Checks</span>
              <span class="detail-item__value">{{ getHealthCheckCount() }}</span>
            </div>

            <div class="detail-item">
              <span class="detail-item__label">Check Duration</span>
              <span class="detail-item__value">{{ getHealthDuration() }}</span>
            </div>

            <div class="detail-item">
              <span class="detail-item__label">Last Response</span>
              <span class="detail-item__value">{{ data.timestamp | date:'dd/MM/yyyy HH:mm:ss' }}</span>
            </div>

            @if (data.summary) {
              <div class="detail-item">
                <span class="detail-item__label">Healthy</span>
                <span class="detail-item__value detail-item__value--success">{{ data.summary.healthy }}</span>
              </div>

              @if (data.summary.degraded > 0) {
                <div class="detail-item">
                  <span class="detail-item__label">Degraded</span>
                  <span class="detail-item__value detail-item__value--warning">{{ data.summary.degraded }}</span>
                </div>
              }

              @if (data.summary.unhealthy > 0) {
                <div class="detail-item">
                  <span class="detail-item__label">Unhealthy</span>
                  <span class="detail-item__value detail-item__value--error">{{ data.summary.unhealthy }}</span>
                </div>
              }
            }
          </div>
        </div>

        <!-- Health Checks Details -->
        @if (data.checks && data.checks.length > 0) {
          <div class="detail-card">
            <h3 class="detail-card__title">Health Checks</h3>

            <div class="checks-list">
              @for (check of data.checks; track check.name) {
                <div class="check-item" [class.check-item--healthy]="check.status.toLowerCase() === 'healthy'"
                     [class.check-item--degraded]="check.status.toLowerCase() === 'degraded'"
                     [class.check-item--unhealthy]="check.status.toLowerCase() === 'unhealthy'">
                  <div class="check-item__header">
                    <div class="check-item__name">
                      <span class="check-status-dot"></span>
                      {{ check.name }}
                    </div>
                    <div class="check-item__status">{{ check.status }}</div>
                  </div>

                  @if (check.description) {
                    <div class="check-item__description">{{ check.description }}</div>
                  }

                  <div class="check-item__meta">
                    <span class="check-meta-item">
                      <span class="material-icons">timer</span>
                      {{ check.duration.toFixed(2) }}ms
                    </span>
                    @if (check.tags.length > 0) {
                      <span class="check-meta-item">
                        <span class="material-icons">label</span>
                        {{ check.tags.join(', ') }}
                      </span>
                    }
                  </div>

                  @if (check.error) {
                    <div class="check-item__error">
                      <span class="material-icons">error</span>
                      {{ check.error }}
                    </div>
                  }
                </div>
              }
            </div>
          </div>
        }
      </div>
    }

    <!-- Error Information -->
    @if (healthCheck.errorMessage(); as error) {
      <div class="api-status__error">
        <div class="error-card">
          <div class="error-card__header">
            <span class="material-icons">error</span>
            <h3>Connection Error</h3>
          </div>
          <p class="error-card__message">{{ error }}</p>
          <div class="error-card__details">
            <span>Last attempt: {{ healthCheck.getTimeSinceLastCheck() }}</span>
          </div>
        </div>
      </div>
    }

    <!-- Monitoring Information -->
    <div class="api-status__info">
      <div class="info-card">
        <h3 class="info-card__title">Monitoring Details</h3>
        <div class="info-list">
          <div class="info-item">
            <span class="material-icons">schedule</span>
            <span>Automatic check every 30 seconds</span>
          </div>
          <div class="info-item">
            <span class="material-icons">timer</span>
            <span>2-minute timeout per request</span>
          </div>
          <div class="info-item">
            <span class="material-icons">sync</span>
            <span>Real-time status updates</span>
          </div>
          <div class="info-item">
            <span class="material-icons">security</span>
            <span>HTTPS encrypted connection</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>